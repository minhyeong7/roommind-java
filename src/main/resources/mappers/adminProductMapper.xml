<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.roomgenius.furniture_recommendation.mapper.AdminProductMapper">

<!--  전체조회  -->
    <select id="selectAllProducts" resultType="com.roomgenius.furniture_recommendation.entity.ProductVO">
        SELECT
        product_id     AS productId,
        category_id    AS categoryId,
        product_name   AS productName,
        original_price AS originalPrice,
        sale_price     AS salePrice,
        stock,
        description,
        brand,
        created_date   AS createdDate,
        updated_date   AS updatedDate
        FROM Product
        ORDER BY product_id DESC
    </select>


    <!-- 필터 검색 -->
    <select id="selectFilteredProducts" resultType="com.roomgenius.furniture_recommendation.entity.ProductVO">
        SELECT *
        FROM Product
        WHERE 1 = 1
        <if test="categoryId != null">
            AND category_id = #{categoryId}
        </if>
        <if test="keyword != null and keyword != ''">
            AND product_name LIKE CONCAT('%', #{keyword}, '%')
        </if>

        <choose>
            <when test="sort == 'oldest'">
                ORDER BY product_id ASC
            </when>
            <when test="sort == 'price'">
                ORDER BY sale_price ASC
            </when>
            <otherwise>
                ORDER BY product_id DESC
            </otherwise>
        </choose>
    </select>

    <!-- 단일 조회 -->
    <select id="getProductById" resultType="com.roomgenius.furniture_recommendation.entity.ProductVO">
        SELECT
        product_id AS productId,
        category_id,
        product_name,
        original_price,
        sale_price,
        stock,
        description,
        created_date,
        updated_date
        FROM Product
        WHERE product_id = #{productId}
    </select>

    <!-- 등록 -->
    <insert id="insertProduct" parameterType="com.roomgenius.furniture_recommendation.entity.ProductDTO">
        INSERT INTO Product (
        category_id, product_name, original_price, sale_price, stock, description
        )
        VALUES (
        #{categoryId}, #{productName}, #{originalPrice}, #{salePrice}, #{stock}, #{description}
        )
    </insert>

    <!-- 수정 -->
    <update id="updateProduct" parameterType="com.roomgenius.furniture_recommendation.entity.ProductDTO">
        UPDATE Product
        SET
        category_id = #{categoryId},
        product_name = #{productName},
        original_price = #{originalPrice},
        sale_price = #{salePrice},
        stock = #{stock},
        description = #{description}
        WHERE product_id = #{productId}
    </update>

    <!-- 삭제 -->
    <delete id="deleteProduct" parameterType="int">
        DELETE FROM Product WHERE product_id = #{productId}
    </delete>

</mapper>
